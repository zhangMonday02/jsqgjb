name: 嘉立创自动抢购

on:
  workflow_dispatch:  # 手动触发
  schedule:
    - cron: '0 23 * * *'
    # 每天北京时间9点运行（UTC时间01点）
    # 实际运行可能延迟1小时内，取决于GitHub资源

env: # 公共推送环境变量（所有job共享，从secrets读取）
  TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
  TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
  WECHAT_WEBHOOK_KEY: ${{ secrets.WECHAT_WEBHOOK_KEY }}
  DINGTALK_WEBHOOK: ${{ secrets.DINGTALK_WEBHOOK }}
  PUSHPLUS_TOKEN: ${{ secrets.PUSHPLUS_TOKEN }}
  SERVERCHAN_SCKEY: ${{ secrets.SERVERCHAN_SCKEY }}
  COOLPUSH_SKEY: ${{ secrets.COOLPUSH_SKEY }}
  CUSTOM_WEBHOOK: ${{ secrets.CUSTOM_WEBHOOK }}

jobs:
  running-1:
    runs-on: ubuntu-22.04
    steps:
      - name: '检出代码'
        uses: actions/checkout@v3
      - name: '设置Python环境'
        uses: actions/setup-python@v5
        with:
          python-version: 3.7
      - name: '设置时区为北京时间'
        run: |
          sudo timedatectl set-timezone Asia/Shanghai
          echo "当前时间: $(date)"
      - name: '安装依赖'
        run: |
          pip install --upgrade pip
          pip install pytz
          pip install -r ./requirements.txt
      - name: '准备Chrome驱动'
        uses: nanasess/setup-chromedriver@v2
      - name: '进行抢购'
        run: |
          python ./jlc.py "8774619A" "Zz123123" "${{ secrets.ERROR }}"
